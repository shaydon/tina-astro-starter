---
import BlogPost from "../../layouts/BlogPost.astro"
import client from "../../../tina/__generated__/client";
import AdminBlogPost from "../../../tina/pages/AdminBlogPost";

export async function getStaticPaths() {
	const blogsResponse = await client.queries.blogConnection();
	const blogs = blogsResponse.data.blogConnection.edges;
	return blogs?.flatMap((blog) => !!blog?.node ? {
		params: { slug: blog.node._sys.relativePath.replace(/\.mdx?$/, '') }
	} : []) || [];
}

const {slug} = Astro.params;
const data = await (slug ? client.queries.blog({relativePath: `${slug}.mdx`}) : undefined);
if (!data) return Astro.redirect('/404');
---

<BlogPost title={data.data.blog.title} description={data.data.blog.description}>
		<AdminBlogPost {...data} client:tina/>
</BlogPost>
